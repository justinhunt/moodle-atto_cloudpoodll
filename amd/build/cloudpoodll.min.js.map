{"version":3,"sources":["../src/cloudpoodll.js"],"names":["root","factory","define","amd","CloudPoodll","version","baseURL","params","fetchContainers","classname","divs","document","getElementsByClassName","autoCreateRecorders","containers","ctr","length","insertRecorder","createRecorder","elementid","theelement","getElementById","container","attributes","parseAttributes","iframe","createIframe","appendChild","setAttribute","i","attr","getAttribute","hasOwnProperty","window","location","protocol","hostname","guess_mimetype","createElement","localloading","iframeurl","isIOS_safari","is_ios","is_safari","property","iframeclass","width","height","theCallback","data","type","inputControl","updatecontrol","pokeInput","theurl","mediaurl","value","alert","message","initEvents","that","addEventListener","e","sendMessage","containerid","messageObject","theiframe","getElementsByTagName","contentWindow","postMessage","fetchroot","test","navigator","userAgent","MSStream","mediatype","transcribe","hints","includes","nVer","appVersion","nAgt","browserName","appName","fullVersion","parseFloat","nameOffset","verOffset","match","indexOf","lastIndexOf","substring","toLowerCase","toUpperCase","OS","browser","name","mimetype"],"mappings":"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","sourcesContent":["\r\n/**\r\n * root is our root object context, ie. window if we are in a browser\r\n * factory is a method that builds and returns our module\r\n */\r\n(function(root, factory) {\r\n    // If AMD is available, use the define() method to load our dependencies\r\n    //and declare our module\r\n    if (typeof define === 'function' && define.amd) {\r\n        define([], function() {\r\n            return factory(root);\r\n        });\r\n    }\r\n    // Otherwise we will attach our module to root, and pass references to our\r\n    // dependencies into the factory. We're assuming that our dependencies are\r\n    // also attached to root here, but they could come from anywhere\r\n    else\r\n    {\r\n        root.CloudPoodll = factory(root);\r\n    }\r\n})(this, function(root) {\r\n    // This is our factory method. Return our module object here...\r\n    return {\r\n        version: '1.2.8',\r\n        baseURL: 'https://cloud.poodll.com/local/cpapi/fastpoodllloader.php',\r\n        //baseURL: 'http://localhost/moodle/local/cpapi/fastpoodllloader.php',\r\n        params: ['parent','appid','timelimit','type','media','updatecontrol','width','height','id',\r\n            'iframeclass','transcode','transcoder','transcribe','subtitle','language','transcribevocab',\r\n            'expiredays','owner','region','token','localloader','localloading','notificationurl',\r\n            'sourcemimetype','speechevents','hints','alreadyparsed','fallback'],\r\n\r\n        fetchContainers: function(classname){\r\n            var divs = document.getElementsByClassName(classname);\r\n            return divs;\r\n        },\r\n        autoCreateRecorders: function(classname){\r\n            if(!classname){classname='cloudpoodll';}\r\n            var containers = this.fetchContainers(classname);\r\n            for(var ctr=0;ctr<containers.length;ctr++){\r\n                this.insertRecorder(containers[ctr]);\r\n            }\r\n        },\r\n        createRecorder: function(elementid){\r\n            var theelement=document.getElementById(elementid);\r\n            this.insertRecorder(theelement);\r\n        },\r\n\r\n        insertRecorder: function(container, attributes){\r\n            if(attributes == undefined) {\r\n                attributes = this.parseAttributes(container);\r\n            }\r\n            var iframe = this.createIframe(attributes);\r\n            if(iframe) {\r\n                container.appendChild(iframe);\r\n                container.setAttribute('data-alreadyparsed','true');\r\n            }\r\n        },\r\n        parseAttributes: function(container){\r\n            var attributes = {};\r\n            for(var i=0;i<this.params.length;i++){\r\n                var attr = container.getAttribute('data-' + this.params[i]);\r\n                if(attr!==null){\r\n                    attributes[this.params[i]]=attr;\r\n                }\r\n            }\r\n            return attributes;\r\n        },\r\n        createIframe: function(attributes){\r\n\r\n            //cancel out if this div was already processed\r\n            if(attributes.hasOwnProperty('alreadyparsed') ){\r\n                if(attributes['alreadyparsed']=='true'){\r\n                   // console.log(\"Can only parse a cloudpoodll element once. Cancelling.\");\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            //fix up default attributes if the user did not set them\r\n            //parent\r\n            if(!attributes.hasOwnProperty('parent') ){\r\n                attributes['parent']=window.location.protocol + '//' + window.location.hostname;\r\n            }\r\n            //media\r\n            if(!attributes.hasOwnProperty('media') ){\r\n                attributes['media']='audio';\r\n            }\r\n            //also store predicted mimetype\r\n            attributes['sourcemimetype'] = this.guess_mimetype(attributes['media'],attributes['transcribe'],attributes['hints']);\r\n\r\n            //build and set the iframe src url\r\n            var iframe = document.createElement('iframe');\r\n\r\n            //set up the base URL for the iframe\r\n            //if we need and can load locally from html we do that\r\n            if(!attributes.hasOwnProperty('localloader')){\r\n                var localloading = 'never';\r\n            }else {\r\n                var localloading = attributes.hasOwnProperty('localloading') ? attributes['localloading'] : 'auto';\r\n            }\r\n\r\n            switch(localloading){\r\n\r\n                case 'always':\r\n                    var iframeurl = attributes['parent'] + attributes['localloader'] + '?';\r\n                    break;\r\n\r\n                case 'never':\r\n                    var iframeurl = this.baseURL + '?';\r\n                    break;\r\n\r\n                case 'auto':\r\n                default:\r\n                    var isIOS_safari = this.is_ios() || this.is_safari();\r\n                    if(isIOS_safari) {\r\n                        var iframeurl = attributes['parent'] + attributes['localloader'] + '?';\r\n                    }else {\r\n                        var iframeurl = this.baseURL + '?';\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            //build iframeurl based on baseurl and attributes\r\n            for (var property in attributes) {\r\n                iframeurl = iframeurl + property + '=' + attributes[property] + '&';\r\n            }\r\n            iframe.setAttribute('src', iframeurl);\r\n\r\n            //do any iframe attributes that we need to\r\n            //width and height (only if no iframe class specified)\r\n            //see here for responsive iframe ..https://blog.theodo.fr/2018/01/responsive-iframes-css-trick/\r\n            if(attributes.hasOwnProperty('iframeclass')) {\r\n                iframe.setAttribute('class', attributes.iframeclass);\r\n            }else{\r\n                if(!attributes.hasOwnProperty('width') ){\r\n                    attributes['width']=350;\r\n                }\r\n                iframe.setAttribute('width', attributes.width);\r\n                if(!attributes.hasOwnProperty('height') ){\r\n                    if(attributes['media']=='audio') {\r\n                        attributes['height'] = 250;\r\n                    }else{\r\n                        attributes['height'] = 550;\r\n                    }\r\n                }\r\n                iframe.setAttribute('height', attributes.height);\r\n            }\r\n            iframe.setAttribute('frameBorder', 0);\r\n            iframe.setAttribute('allow', 'camera,microphone');\r\n            return iframe;\r\n        },\r\n        theCallback: function(data) {\r\n            switch(data.type){\r\n                case 'filesubmitted':\r\n                    var inputControl = data.updatecontrol;\r\n                    var pokeInput = document.getElementById(inputControl);\r\n                    var theurl = data.mediaurl;\r\n                    if (pokeInput) {\r\n                        pokeInput.value = theurl;\r\n                    }\r\n                    break;\r\n                case 'error':\r\n                    alert('ERROR:' . data.message);\r\n            }\r\n        },\r\n        initEvents: function(){\r\n            var that = this;\r\n            window.addEventListener('message', function(e) {\r\n                var data = e.data;\r\n                if (data && data.hasOwnProperty('id') && data.hasOwnProperty('type')){\r\n                    that.theCallback(data);\r\n                }\r\n            });\r\n        },\r\n        sendMessage: function(containerid,messageObject){\r\n\r\n            if(!messageObject.hasOwnProperty('type')){\r\n                //'All message objects must have at least the \"type\" property'\r\n                return;\r\n            }\r\n\r\n            var theiframe = document.getElementById(containerid).getElementsByTagName('iframe')[0];\r\n\r\n            //messageObject.id = this.id;\r\n            theiframe.contentWindow.postMessage(messageObject);\r\n\r\n        },\r\n        fetchroot: function(){\r\n            return root;\r\n        },\r\n\r\n        is_safari: function(){\r\n            return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n        },\r\n\r\n        is_ios: function(){\r\n            return  /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\r\n        },\r\n\r\n        guess_mimetype: function(mediatype, transcribe, hints){\r\n\r\n            //if we are using Google Cloud Speech Transcribe then we only support audio/wav\r\n            if(transcribe==2){\r\n                return \"audio/wav\";\r\n            }\r\n            //this is a bit hacky, we should base64decode hints and look for the value of hints.encoder\r\n            if(hints && hints.includes('stereoaudio')){\r\n                return \"audio/wav\";\r\n            }\r\n\r\n            var nVer = navigator.appVersion;\r\n            var nAgt = navigator.userAgent;\r\n            var browserName  = navigator.appName;\r\n            //decided no real benefit and some danger in detecting version, so commented it mostly\r\n            var fullVersion  = ''+parseFloat(navigator.appVersion);\r\n            var nameOffset,verOffset,ix;\r\n\r\n            if(nAgt.match('(?:Edge|EdgA|EdgiOS)')!==null) {\r\n                browserName=\"Edge\";\r\n                //dont know how to get this and its probably not important yet\r\n                //fullVersion = '1.0';\r\n\r\n            // In Opera, the true version is after \"Opera\" or after \"Version\"\r\n            }else if ((verOffset=nAgt.indexOf(\"Opera\"))!=-1) {\r\n                browserName = \"Opera\";\r\n                //fullVersion = nAgt.substring(verOffset+6);\r\n                //if ((verOffset=nAgt.indexOf(\"Version\"))!=-1) fullVersion = nAgt.substring(verOffset+8);\r\n            }\r\n            // In MSIE, the true version is after \"MSIE\" in userAgent\r\n            else if ((verOffset=nAgt.indexOf(\"MSIE\"))!=-1) {\r\n                browserName = \"IE\";\r\n                //fullVersion = nAgt.substring(verOffset+5);\r\n            }\r\n            // In Chrome, the true version is after \"Chrome\"\r\n            else if ((verOffset=nAgt.indexOf(\"Chrome\"))!=-1) {\r\n                browserName = \"Chrome\";\r\n                //fullVersion = nAgt.substring(verOffset+7);\r\n            }\r\n            // In Safari, the true version is after \"Safari\" or after \"Version\"\r\n            else if ((verOffset=nAgt.indexOf(\"Safari\"))!=-1) {\r\n                browserName = \"Safari\";\r\n                //fullVersion = nAgt.substring(verOffset+7);\r\n                //if ((verOffset=nAgt.indexOf(\"Version\"))!=-1)fullVersion = nAgt.substring(verOffset+8);\r\n            }\r\n            // In Firefox, the true version is after \"Firefox\"\r\n            else if ((verOffset=nAgt.indexOf(\"Firefox\"))!=-1) {\r\n                browserName = \"Firefox\";\r\n                //fullVersion = nAgt.substring(verOffset + 8);\r\n                // In most other browsers, \"name/version\" is at the end of userAgent\r\n            }else if ( (nameOffset=nAgt.lastIndexOf(' ')+1) <\r\n                (verOffset=nAgt.lastIndexOf('/')) )\r\n            {\r\n                browserName = nAgt.substring(nameOffset,verOffset);\r\n                //fullVersion = nAgt.substring(verOffset+1);\r\n                if (browserName.toLowerCase()==browserName.toUpperCase()) {\r\n                    browserName = navigator.appName;\r\n                }\r\n            }\r\n\r\n\r\n            //OS detection\r\n            var OS = \"Unknown OS\";\r\n            if (navigator.userAgent.indexOf(\"Win\") != -1){OS = \"Windows\";}\r\n            if (navigator.userAgent.indexOf(\"Mac\") != -1) {OS = \"Macintosh\";}\r\n            if (navigator.userAgent.indexOf(\"Linux\") != -1){OS = \"Linux\";}\r\n            if (navigator.userAgent.indexOf(\"Android\") != -1){OS = \"Android\";}\r\n            if (navigator.userAgent.indexOf(\"like Mac\") != -1) {OS = \"iOS\";}\r\n\r\n\r\n            var browser={};\r\n            browser.name=browserName;\r\n            browser.version=fullVersion;\r\n            browser.OS=OS;\r\n\r\n            //predicted mimetype\r\n            var mimetype=\"unsupported/unsupported\";\r\n            if(mediatype=='video'){\r\n                switch(browser.name){\r\n                    case 'Edge':\r\n                    case 'MSIE':\r\n                        mimetype=\"video/webm\";\r\n                        break;\r\n                    case 'Safari':\r\n                        mimetype=\"video/quicktime\";\r\n                        break;\r\n                    case 'Firefox':\r\n                    case 'Chrome':\r\n                    case 'Opera':\r\n                    default:\r\n                        mimetype=\"video/webm\";\r\n                }\r\n            }else{\r\n                switch(browser.name){\r\n                    case 'MSIE':\r\n                        mimetype=\"audio/wav\";\r\n                        break;\r\n                    case 'Edge':\r\n                    case 'Safari':\r\n                        mimetype=\"audio/wav\";\r\n                        break;\r\n                    case 'Firefox':\r\n                        mimetype=\"audio/ogg\";\r\n                        break;\r\n                    case 'Chrome':\r\n                    case 'Opera':\r\n                    default:\r\n                        mimetype=\"audio/webm\";\r\n                }\r\n            }\r\n            /*\r\n            document.write(''\r\n                +'Browser name  = '+browser.name+'<br>'\r\n                +'Full version  = '+browser.version+'<br>'\r\n                +'OS  = '+browser.OS+'<br>'\r\n                +'mimetype  = '+mimetype+'<br>'\r\n            )\r\n            */\r\n            return mimetype;\r\n        }//end of guess mimetype\r\n    };//end of returned object (poodllcloud)\r\n});//end of factory method container"],"file":"cloudpoodll.min.js"}