define(["jquery","core/log"],function(a,b){"use strict";return b.debug("Filter PoodLL: utils initialising"),{timeouthandles:[],WhiteboardUploadHandler:function(b,c,d,e){var f=a("#"+b+"_btn_upload_whiteboard")[0];f.disabled=!0,clearTimeout(this.timeouthandles[b]);var g=this.getCvs(b,c,d);this.pokeVectorData(b,c,d),e.uploadFile(g.toDataURL(),"image")},getCvs:function(a,b){if(0==a.indexOf("drawingboard_"))var c=b.canvas;else var c=b.canvasForExport();return c},escapeColon:function(a){return a.replace(/:/,"\\:")},pokeVectorData:function(c,d,e){var f="";f=0==c.indexOf("drawingboard_")?JSON.stringify(d.history,null,2):JSON.stringify(d.getSnapshot()),"undefined"!=typeof e.vectorcontrol&&""!==e.vectorcontrol&&(a("#"+this.escapeColon(e.vectorcontrol)).val(f),b.debug("Vectorcontrol:"+e.vectorcontrol))},_concatenateWavBlobs:function(a,b){for(var c=[],d=0,e=0,f=a.length,g=0;g<f;g++)!function(h){var i=new FileReader;i.onload=function(){var a=this.result,g=a.slice(44);if(e+=g.byteLength,c[h]=g,d++,d==f){var i=a.slice(0,44),j=new DataView(i);j.setUint32(40,e,!0),c.unshift(i);var k=new Blob(c,{type:"audio/wav"});b(k)}},i.readAsArrayBuffer(a[g])}(g)},_standardConcatenateBlobs:function(a,b,c){function d(){if(!a[g])return e();var b=new FileReader;b.onload=function(a){f.push(a.target.result),g++,d()},b.readAsArrayBuffer(a[g])}function e(){var a=0;f.forEach(function(b){a+=b.byteLength});var d=new Uint16Array(a),e=0;f.forEach(function(a){var b=a.byteLength;b%2!=0&&(a=a.slice(0,b-1)),d.set(new Uint16Array(a),e),e+=b});var g=new Blob([d.buffer],{type:b});c(g)}var f=[],g=0;d()},_simpleConcatenateBlobs:function(a,b){return new Blob(a,{type:b})},doConcatenateBlobs:function(a,b){switch(a[0].type){case"audio/wav":case"audio/pcm":this._concatenateWavBlobs(a,b);break;case"audio/ogg":case"audio/webm":case"video/webm":default:var c=this._simpleConcatenateBlobs(a,a[0].type);b(c);break;case"old default":this._standardConcatenateBlobs(a,a[0].type,b)}},bytesToSize:function(a){var b=1e3,c=["Bytes","KB","MB","GB","TB"];if(0===a)return"0 Bytes";var d=parseInt(Math.floor(Math.log(a)/Math.log(b)),10);return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]},getTimeLength:function(a){var b=new Date(a);return b.getUTCHours()+" hours, "+b.getUTCMinutes()+" minutes and "+b.getUTCSeconds()+" second(s)"},has_mediarecorder:function(){return"undefined"!=typeof MediaRecorder},can_html5_record:function(a){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&("audio"==a||this.has_mediarecorder())},is_edge:function(){return navigator.userAgent.indexOf("Edge")>-1},is_chrome:function(){var a=window.chrome,b=window.navigator,c=b.vendor,d=b.userAgent.indexOf("OPR")>-1,e=b.userAgent.indexOf("Edge")>-1,f=b.userAgent.match("CriOS");return!!f||null!==a&&"undefined"!=typeof a&&"Google Inc."===c&&d===!1&&e===!1},is_safari:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},is_ios:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},is_opera:function(){return"undefined"!=typeof opera&&navigator.userAgent&&navigator.userAgent.indexOf("OPR/")!==-1},is_android:function(){var a=window.navigator.userAgent,b=a.indexOf("android")>-1||a.indexOf("Android")>-1;return b},is_ie:function(){var a=!1,b=window.navigator.userAgent,c=b.indexOf("MSIE "),d=b.indexOf("Trident/"),e=b.indexOf("Edge/");return(c>-1||d>-1||e>-1)&&(a=!0),a},parseQueryString:function(a){var b={};return a.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(a,c,d,e){b[c]=e}),b}}});