YUI.add("moodle-atto_cloudpoodll-button",function(e,t){var n="atto_cloudpoodll",r={VIDEO:"video",AUDIO:"audio"},i={LINK:"link",TAGS:"tags"},s={},o={VIDEO:"atto_cloudpoodll_video",AUDIO:"atto_cloudpoodll_audio",UPLOAD:"atto_cloudpoodll_upload",SUBTITLE:"atto_cloudpoodll_subtitle",SUBTITLE_CHECKBOX:"atto_cloudpoodll_subtitle_checkbox",MEDIAINSERT_CHECKBOX:"atto_cloudpoodll_mediainsert_checkbox",ATTO_CLOUDPOODLL_FORM:"atto_cloudpoodll_form",CP_VIDEO:"atto_cloudpoodll_video_cont",CP_AUDIO:"atto_cloudpoodll_audio_cont",CP_UPLOAD:"atto_cloudpoodll_upload_cont",CP_SWAP:"atto_cloudpoodll_swapmeout"},u={subtitling:!1,started:!1,currentrecorder:!1,insertmethod:!1,elementid:!1,subtitlecheckbox:!1},a={ROOT:'<form class="mform atto_form atto_media atto_cloudpoodll_form" id="{{elementid}}_atto_cloudpoodll_form"><ul class="root nav nav-tabs" role="tablist">{{#if isvideo}}<li data-medium-type="{{CSS.VIDEO}}" class="nav-item"><a class="nav-link active" href="#{{elementid}}_{{CSS.VIDEO}}" role="tab" data-toggle="tab">{{get_string "video" component}}</a></li>{{else}}<li data-medium-type="{{CSS.AUDIO}}" class="nav-item"><a class="nav-link active" href="#{{elementid}}_{{CSS.AUDIO}}" role="tab" data-toggle="tab">{{get_string "audio" component}}</a></li>{{/if}}<li data-medium-type="{{CSS.UPLOAD}}" class="nav-item"><a class="nav-link" href="#{{elementid}}_{{CSS.UPLOAD}}" role="tab" data-toggle="tab">{{get_string "upload" component}}</a></li>{{#if cansubtitle}}<li data-medium-type="{{CSS.SUBTITLE}}" class="nav-item"><a class="nav-link" href="#{{elementid}}_{{CSS.SUBTITLE}}" role="tab" data-toggle="tab">{{get_string "subtitle" component}}</a></li>{{/if}}</ul><div class="root tab-content">{{#if isvideo}}<div data-medium-type="{{CSS.VIDEO}}" class="tab-pane active" id="{{elementid}}_{{CSS.VIDEO}}"><div id="{{elementid}}_{{CSS.CP_VIDEO}}" class="{{CSS.CP_SWAP}}" data-id="{{elementid}}_{{CSS.CP_VIDEO}}" data-parent="{{CP.parent}}"data-media="video" data-type="{{CP.videoskin}}" data-width="450" data-height="380"data-transcode="{{CP.transcode}}" data-transcribe="0" data-transcribelanguage="{{CP.language}}"data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-token="{{CP.token}}" data-fallback="{{CP.fallback}}"></div></div>{{else}}<div data-medium-type="{{CSS.AUDIO}}" class="tab-pane active" id="{{elementid}}_{{CSS.AUDIO}}"><div id="{{elementid}}_{{CSS.CP_AUDIO}}" class="{{CSS.CP_SWAP}}" data-id="{{elementid}}_{{CSS.CP_AUDIO}}" data-parent="{{CP.parent}}"data-media="audio" data-type="{{CP.audioskin}}" data-width="450" data-height="350"data-transcode="{{CP.transcode}}" data-transcribe="0" data-transcribelanguage="{{CP.language}}"data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-token="{{CP.token}}" data-fallback="{{CP.fallback}}"></div></div>{{/if}}<div data-medium-type="{{CSS.UPLOAD}}" class="tab-pane" id="{{elementid}}_{{CSS.UPLOAD}}"><div id="{{elementid}}_{{CSS.CP_UPLOAD}}" class="{{CSS.CP_SWAP}}" data-id="{{elementid}}_{{CSS.CP_UPLOAD}}" data-parent="{{CP.parent}}"data-media="{{recorder}}" data-type="upload" data-width="450" data-height="350"data-transcode="{{CP.transcode}}" data-transcribe="0" data-transcribelanguage="{{CP.language}}"data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-token="{{CP.token}}"></div></div>{{#if cansubtitle}}<div data-medium-type="{{CSS.SUBTITLE}}" class="tab-pane" id="{{elementid}}_{{CSS.SUBTITLE}}">{{get_string "subtitleinstructions" component}}<br><br><label><input type="checkbox" id="{{elementid}}_{{CSS.SUBTITLE_CHECKBOX}}" class="{{CSS.SUBTITLE_CHECKBOX}}"/>&nbsp;{{get_string "subtitlecheckbox" component}}<br><label><input type="checkbox" id="{{elementid}}_{{CSS.MEDIAINSERT_CHECKBOX}}" class="{{CSS.MEDIAINSERT_CHECKBOX}}"{{#if mediataginsert}} checked="true" {{/if}}/>&nbsp;{{get_string "mediainsertcheckbox" component}}</label></div>{{/if}}</div></form>',HTML_MEDIA:{VIDEO:'&nbsp;<video controls="true" crossorigin="anonymous"><source src="{{url}}">{{#if issubtitling}}<track src="{{subtitleurl}}" kind="captions" srclang="{{language}}" label="{{language}}" default="true">{{/if}}</video>&nbsp;',AUDIO:'&nbsp;<audio controls="true" crossorigin="anonymous"><source src="{{url}}">{{#if issubtitling}}<track src="{{subtitleurl}}" kind="captions" srclang="{{language}}" label="{{language}}" default="true">{{/if}}</audio>&nbsp;',LINK:'{{#if issubtitling}}&nbsp;<a href="{{url}}?data-subtitles={{subtitleurl}}&data-language={{language}}"{{else}}&nbsp;<a href="{{url}}"{{/if}}>{{name}}</a>&nbsp;'}};e.namespace("M.atto_cloudpoodll").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(e){var t=new Array("audio","video");for(var n=0;n<t.length;n++)e.hasOwnProperty(t[n])&&this.addButton({icon:t[n],iconComponent:"atto_cloudpoodll",title:t[n]+"_desc",buttonName:t[n],callback:this._displayDialogue,callbackArgs:t[n]});u.insertmethod=e.insertmethod,s.parent=M.cfg.wwwroot,s.token=e.cp_token,s.region=e.cp_region,s.expiredays=e.cp_expiredays,s.cansubtitle=e.cp_cansubtitle,s.language=e.cp_language,s.transcode=e.cp_transcode,s.audioskin=e.cp_audioskin,s.videoskin=e.cp_videoskin,s.fallback=e.fallback},_getContext:function(t){return e.merge({elementid:this.get("host").get("elementid"),component:n,helpStrings:this.get("help"),isvideo:u.currentrecorder==r.VIDEO,cansubtitle:s.cansubtitle,recorder:u.currentrecorder,mediataginsert:u.insertmethod==i.TAGS,CSS:o,CP:s},t)},_displayDialogue:function(t,s){if(this.get("host").getSelection()===!1)return;u.currentrecorder=s;switch(s){case r.VIDEO:var a=M.util.get_string("createvideo",n),f="500px";break;case r.AUDIO:default:var a=M.util.get_string("createaudio",n),f="500px"}var l={};l.headerContent=a,l.focusAfterHide=s,l.width=f;var c=this.getDialogue(l);c.set("bodyContent",this._getDialogueContent()).show(),u.elementid=this.get("host").get("elementid"),u.subtitlecheckbox=e.one("#"+u.elementid+"_"+o.SUBTITLE_CHECKBOX),u.mediainsertcheckbox=e.one("#"+u.elementid+"_"+o.MEDIAINSERT_CHECKBOX);var h=e.one("#"+
u.elementid+"_"+o.ATTO_CLOUDPOODLL_FORM),p=this;u.subtitlecheckbox!=null&&u.subtitlecheckbox.on("click",function(e){var t=e.currentTarget;t.get("checked")?(h.all("."+o.CP_SWAP).setAttribute("data-transcribe","1"),h.all("."+o.CP_SWAP).setAttribute("data-subtitle","1"),h.all("."+o.CP_SWAP).setAttribute("data-alreadyparsed","false"),u.subtitling=!0):(h.all("."+o.CP_SWAP).setAttribute("data-transcribe","0"),h.all("."+o.CP_SWAP).setAttribute("data-subtitle","0"),h.all("."+o.CP_SWAP).setAttribute("data-alreadyparsed","false"),u.subtitling=!1),h.all("."+o.CP_SWAP).empty(),p._loadRecorders()}),u.mediainsertcheckbox!=null&&u.mediainsertcheckbox.on("click",function(e){var t=e.currentTarget;t.get("checked")?u.insertmethod=i.TAGS:u.insertmethod=i.LINK}),this._loadRecorders()},_loadRecorders:function(){var e=this;e.uploaded=!1,require(["atto_cloudpoodll/cloudpoodllloader"],function(t){var n=function(t){switch(t.type){case"recording":t.action==="started"&&u.subtitlecheckbox!=null&&u.subtitlecheckbox.set("disabled",!0);break;case"awaitingprocessing":e.uploaded||(e._doInsert(t.mediaurl,t.mediafilename),e.uploaded=!0)}};t.init(o.CP_SWAP,n)})},_getDialogueContent:function(t){var n=e.Node.create(e.Handlebars.compile(a.ROOT)(this._getContext()));return n},_doInsert:function(t,n){this.getDialogue({focusAfterHide:null}).hide();var o={};o.url=t,o.name=n,o.issubtitling=u.subtitling,o.language=s.language,o.subtitleurl=t+".vtt";var f=a.HTML_MEDIA.LINK;switch(u.insertmethod){case i.TAGS:u.currentrecorder==r.VIDEO?(o.width=!1,o.height=!1,o.poster=!1,f=a.HTML_MEDIA.VIDEO):(o.width=!1,o.height=!1,o.poster=!1,f=a.HTML_MEDIA.AUDIO);break;case i.LINK:default:}var l=e.Handlebars.compile(f)(o);this.editor.focus(),this.get("host").insertContentAtFocusPoint(l),this.markUpdated()}},{ATTRS:{disabled:{value:!1}}})},"@VERSION@");
