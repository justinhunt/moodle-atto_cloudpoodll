YUI.add("moodle-atto_cloudpoodll-button",function(c,e){var p="atto_cloudpoodll",r="video",u="audio",g="link",_="tags",t={ENUS:"en-US",ENGB:"en-GB",ENAU:"en-AU",ENIN:"en-IN",FRCA:"fr-CA",FRFR:"fr-FR",ESUS:"es-US",ESES:"es-ES",ITIT:"it-IT",PTBR:"pt-BR",DEDE:"de-DE",KOKR:"ko-KR",HIIN:"hi-IN",ARAE:"ar-AE",ARSA:"ar-SA",ZHCN:"zh-CN",NLNL:"nl-NL",ENIE:"en-IE",ENWL:"en-WL",ENAB:"en-AB",FAIR:"fa-IR",DECH:"de-CH",HEIL:"he-IL",IDID:"id-ID",JAJP:"ja-JP",MSMY:"ms-MY",PTPT:"pt-PT",RURU:"ru-RU",TAIN:"ta-IN",TEIN:"te-IN",TRTR:"tr-TR"},m={},f="standard",b="bmr",h="onetwothree",v={VIDEO:"atto_cloudpoodll_video",AUDIO:"atto_cloudpoodll_audio",WIDGETS:"atto_cloudpoodll_audio",UPLOAD:"atto_cloudpoodll_upload",SUBTITLE:"atto_cloudpoodll_subtitle",OPTIONS:"atto_cloudpoodll_options",HISTORY:"atto_cloudpoodll_history",LANG_SELECT:"atto_cloudpoodll_languageselect",SUBTITLE_CHECKBOX:"atto_cloudpoodll_subtitle_checkbox",MEDIAINSERT_CHECKBOX:"atto_cloudpoodll_mediainsert_checkbox",ATTO_CLOUDPOODLL_FORM:"atto_cloudpoodll_form",CP_VIDEO:"atto_cloudpoodll_video_cont",CP_AUDIO:"atto_cloudpoodll_audio_cont",CP_UPLOAD:"atto_cloudpoodll_upload_cont",CP_SWAP:"atto_cloudpoodll_swapmeout"},A={subtitling:0,transcoding:!1,started:!1,currentrecorder:!1,insertmethod:!1,subitleaudiobydefault:0,subitlevideobydefault:0,elementid:!1,subtitlecheckbox:!1,filetitledisplaylength:30,showhistory:!0},
i='<form class="mform atto_form atto_cloudpoodll_form" id="{{elementid}}_atto_cloudpoodll_form"><ul class="root nav nav-tabs" role="tablist">{{#if isvideo}}<li data-medium-type="{{CSS.VIDEO}}" class="nav-item"><a class="nav-link active" href="#{{elementid}}_{{CSS.VIDEO}}" role="tab" data-toggle="tab">{{get_string "video" component}}</a></li>{{else}}<li data-medium-type="{{CSS.AUDIO}}" class="nav-item"><a class="nav-link active" href="#{{elementid}}_{{CSS.AUDIO}}" role="tab" data-toggle="tab">{{get_string "audio" component}}</a></li>{{/if}}<li data-medium-type="{{CSS.UPLOAD}}" class="nav-item"><a class="nav-link" href="#{{elementid}}_{{CSS.UPLOAD}}" role="tab" data-toggle="tab">{{get_string "upload" component}}</a></li><li data-medium-type="{{CSS.OPTIONS}}" class="nav-item"><a class="nav-link" href="#{{elementid}}_{{CSS.OPTIONS}}" role="tab" data-toggle="tab">{{get_string "options" component}}</a></li>{{#if showhistory}}<li data-medium-type="{{CSS.HISTORY}}" class="nav-item" data-content="history" ><a class="nav-link" href="#{{elementid}}_{{CSS.HISTORY}}" role="tab" data-toggle="tab">{{get_string "history" component}}</a></li>{{/if}}</ul><div class="root tab-content">{{#if isvideo}}<div data-medium-type="{{CSS.VIDEO}}" class="tab-pane active" id="{{elementid}}_{{CSS.VIDEO}}"><div id="id_responsive_atto_cloudpoodll_video_cont"><div id="{{elementid}}_{{CSS.CP_VIDEO}}" class="{{CSS.CP_SWAP}}" data-iframeclass="atto_cloudpoodll_iframe" data-id="{{elementid}}_{{CSS.CP_VIDEO}}" data-parent="{{CP.parent}}" data-appid="{{CP.appid}}" data-media="video" data-type="{{CP.videoskin}}" data-localloader="/lib/editor/atto/plugins/cloudpoodll/poodllloader.html" data-localloading="auto" data-width="{{CP.sizes.videowidth}}" data-height="{{CP.sizes.videoheight}}" data-transcode="{{CP.transcode}}" data-transcribe="{{subtitlevideobydefault}}" data-subtitle="{{subtitlevideobydefault}}" data-language="{{CP.language}}" data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-owner="{{CP.owner}}" data-token="{{CP.token}}" data-fallback="{{CP.fallback}}"></div></div></div>{{else}}<div data-medium-type="{{CSS.AUDIO}}" class="tab-pane active" id="{{elementid}}_{{CSS.AUDIO}}"><div id="id_responsive_atto_cloudpoodll_audio_cont"><div id="{{elementid}}_{{CSS.CP_AUDIO}}" class="{{CSS.CP_SWAP}}" data-iframeclass="atto_cloudpoodll_iframe" data-id="{{elementid}}_{{CSS.CP_AUDIO}}" data-parent="{{CP.parent}}" data-appid="{{CP.appid}}" data-media="audio" data-type="{{CP.audioskin}}" data-localloader="/lib/editor/atto/plugins/cloudpoodll/poodllloader.html" data-localloading="auto" data-width="{{CP.sizes.audiowidth}}" data-height="{{CP.sizes.audioheight}}" data-transcode="{{CP.transcode}}" data-transcribe="{{subtitleaudiobydefault}}" data-subtitle="{{subtitleaudiobydefault}}" data-language="{{CP.language}}" data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-owner="{{CP.owner}}" data-token="{{CP.token}}" data-fallback="{{CP.fallback}}"></div></div></div>{{/if}}<div id="{{elementid}}_{{CSS.UPLOAD}}" data-medium-type="{{CSS.UPLOAD}}" class="tab-pane"><br>{{get_string "uploadinstructions" component}}<div id="id_responsive_atto_cloudpoodll_upload_cont"><div id="{{elementid}}_{{CSS.CP_UPLOAD}}" class="{{CSS.CP_SWAP}}" data-iframeclass="atto_cloudpoodll_iframe" data-id="{{elementid}}_{{CSS.CP_UPLOAD}}" data-parent="{{CP.parent}}" data-appid="{{CP.appid}}" data-media="{{recorder}}" data-type="upload" data-width="450" data-height="350" data-transcode="{{CP.transcode}}" {{#if isvideo}}data-transcribe="{{subtitlevideobydefault}}" data-subtitle="{{subtitlevideobydefault}}" {{else}}data-transcribe="{{subtitleaudiobydefault}}" data-subtitle="{{subtitleaudiobydefault}}" {{/if}}data-language="{{CP.language}}"data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-owner="{{CP.owner}}" data-token="{{CP.token}}"></div></div></div><div data-medium-type="{{CSS.OPTIONS}}" class="tab-pane" id="{{elementid}}_{{CSS.OPTIONS}}"><br><label><input type="checkbox" id="{{elementid}}_{{CSS.MEDIAINSERT_CHECKBOX}}" class="{{CSS.MEDIAINSERT_CHECKBOX}}"{{#if mediataginsert}} checked="true" {{/if}}/>&nbsp;{{get_string "mediainsertcheckbox" component}}</label>{{#if cansubtitle}}<br><label><input type="checkbox" id="{{elementid}}_{{CSS.SUBTITLE_CHECKBOX}}" class="{{CSS.SUBTITLE_CHECKBOX}}"{{#if isvideo}}{{#if letssubtitlevideo}} checked="true" {{/if}}{{else}}{{#if letssubtitleaudio}} checked="true" {{/if}}{{/if}}/>&nbsp;{{get_string "subtitlecheckbox" component}}</label><br><label>{{get_string "speakerlanguage" component}}&nbsp;<select id="{{elementid}}_{{CSS.LANG_SELECT}}" class="{{CSS.LANG_SELECT}}"><option value="{{LANG.ARAE}}" {{#if useARAE}}selected="selected"{{/if}}>{{get_string "ar-ae" component}}</option><option value="{{LANG.ARSA}}" {{#if useARSA}}selected="selected"{{/if}}>{{get_string "ar-sa" component}}</option><option value="{{LANG.DEDE}}" {{#if useDEDE}}selected="selected"{{/if}}>{{get_string "de-de" component}}</option><option value="{{LANG.DECH}}" {{#if useDECH}}selected="selected"{{/if}}>{{get_string "de-ch" component}}</option><option value="{{LANG.ENUS}}" {{#if useENUS}}selected="selected"{{/if}}>{{get_string "en-us" component}}</option><option value="{{LANG.ENGB}}" {{#if useENGB}}selected="selected"{{/if}}>{{get_string "en-gb" component}}</option><option value="{{LANG.ENAU}}" {{#if useENAU}}selected="selected"{{/if}}>{{get_string "en-au" component}}</option><option value="{{LANG.ENIN}}" {{#if useENIN}}selected="selected"{{/if}}>{{get_string "en-in" component}}</option><option value="{{LANG.ENIE}}" {{#if useENIE}}selected="selected"{{/if}}>{{get_string "en-ie" component}}</option><option value="{{LANG.ENWL}}" {{#if useENWL}}selected="selected"{{/if}}>{{get_string "en-wl" component}}</option><option value="{{LANG.ENAB}}" {{#if useENAB}}selected="selected"{{/if}}>{{get_string "en-ab" component}}</option><option value="{{LANG.ESUS}}" {{#if useESUS}}selected="selected"{{/if}}>{{get_string "es-us" component}}</option><option value="{{LANG.ESES}}" {{#if useESES}}selected="selected"{{/if}}>{{get_string "es-es" component}}</option><option value="{{LANG.FAIR}}" {{#if useFAIR}}selected="selected"{{/if}}>{{get_string "fa-ir" component}}</option><option value="{{LANG.FRFR}}" {{#if useFRFR}}selected="selected"{{/if}}>{{get_string "fr-fr" component}}</option><option value="{{LANG.FRCA}}" {{#if useFRCA}}selected="selected"{{/if}}>{{get_string "fr-ca" component}}</option><option value="{{LANG.HEIL}}" {{#if useHEIL}}selected="selected"{{/if}}>{{get_string "he-il" component}}</option><option value="{{LANG.HIIN}}" {{#if useHIIN}}selected="selected"{{/if}}>{{get_string "hi-in" component}}</option><option value="{{LANG.ITIT}}" {{#if useITIT}}selected="selected"{{/if}}>{{get_string "it-it" component}}</option><option value="{{LANG.JAJP}}" {{#if useJAJP}}selected="selected"{{/if}}>{{get_string "ja-jp" component}}</option><option value="{{LANG.KOKR}}" {{#if useKOKR}}selected="selected"{{/if}}>{{get_string "ko-kr" component}}</option><option value="{{LANG.MSMY}}" {{#if useMSMY}}selected="selected"{{/if}}>{{get_string "ms-my" component}}</option><option value="{{LANG.NLNL}}" {{#if useNLNL}}selected="selected"{{/if}}>{{get_string "nl-nl" component}}</option><option value="{{LANG.PTPT}}" {{#if usePTPT}}selected="selected"{{/if}}>{{get_string "pt-pt" component}}</option><option value="{{LANG.PTBR}}" {{#if usePTBR}}selected="selected"{{/if}}>{{get_string "pt-br" component}}</option><option value="{{LANG.RURU}}" {{#if useRURU}}selected="selected"{{/if}}>{{get_string "ru-ru" component}}</option><option value="{{LANG.TAIN}}" {{#if useTAIN}}selected="selected"{{/if}}>{{get_string "ta-in" component}}</option><option value="{{LANG.TEIN}}" {{#if useTEIN}}selected="selected"{{/if}}>{{get_string "te-in" component}}</option><option value="{{LANG.TRTR}}" {{#if useTRTR}}selected="selected"{{/if}}>{{get_string "tr-tr" component}}</option><option value="{{LANG.ZHCN}}" {{#if useZHCN}}selected="selected"{{/if}}>{{get_string "zh-cn" component}}</option></select></label><br>{{get_string "subtitleinstructions" component}}{{else}}{{get_string \'cannotsubtitle\' component}}{{/if}}</div>{{#if showhistory}}<div data-medium-type="{{CSS.HISTORY}}" data-field="history" data-loaded="false" class="tab-pane" id="{{elementid}}_{{CSS.HISTORY}}"></div></div>{{/if}}</div></form>'
,n={VIDEO:'&nbsp;<video controls="true" crossorigin="anonymous"  controlsList="nodownload" preload="metadata">{{#if includesourcetrack}}<source src="{{sourceurl}}" type="{{sourcemimetype}}">{{/if}}<source src="{{url}}" type="{{urlmimetype}}">{{#if issubtitling}}<track src="{{subtitleurl}}" kind="captions" srclang="{{CP.language}}" label="{{CP.language}}" default="true">{{/if}}</video>&nbsp;',AUDIO:'&nbsp;<audio controls="true" crossorigin="anonymous" controlsList="nodownload">{{#if includesourcetrack}}<source src="{{sourceurl}}" type="{{sourcemimetype}}">{{/if}}<source src="{{url}}" type="{{urlmimetype}}">{{#if issubtitling}}<track src="{{subtitleurl}}" kind="captions" srclang="{{CP.language}}" label="{{CP.language}}" default="true">{{/if}}</audio>&nbsp;',LINK:'{{#if issubtitling}}&nbsp;<a href="{{url}}?data-subtitles={{subtitleurl}}&data-language={{CP.language}}"{{else}}&nbsp;<a href="{{url}}"{{/if}}>{{name}}</a>&nbsp;'},d='<div id="{{elementid}}_{{innerform}}" class="mdl-align"><h4 class="'+v.HEADERTEXT+'">{{headertext}}</h4></div>',l='<div id="{{elementid}}_{{innerform}}" class="atto_widget_buttons mdl-align" style="width:30%;"><button style="width: 100%;" class="'+v.NAMEBUTTON+'_{{templateindex}} btn btn-info d-block">{{name}}</button></div>',C='<div id="{{elementid}}_{{innerform}}" class="mdl-align">{{variable}}&nbsp;<input type="text" class="'+v.TEMPLATEVARIABLE+'_{{variableindex}} atto_widget_field" value="{{defaultvalue}}"></input></div>',S='<div id="{{elementid}}_{{innerform}}" class="mdl-align">{{variable}}</div>',E='<select class="'+v.TEMPLATEVARIABLE+'_{{variableindex}} atto_widget_field"></select>',N='<option value="{{option}}">{{option}}</option>',a='<form class="atto_form"><div id="{{elementid}}_{{innerform}}" class="mdl-align"><button class="'+v.INPUTSUBMIT+'">{{inserttext}}</button></div></form>',y='<div id="{{elementid}}_{{innerform}}" class="mdl-align"><h4 class="'+v.HEADERTEXT+'">{{headertext}} {{key}}</h4><div class="'+v.INSTRUCTIONSTEXT+'">{{instructions}}</div></div>',I=null;c.namespace("M.atto_cloudpoodll").Button=c.Base.create("button",c.M.editor_atto.EditorPlugin,[],{initializer:function(e){var t,i;if(!e.disabled){for(t=new Array("audio","video","widgets"),i=0;i<t.length;i++)e.hasOwnProperty(t[i])&&this.addButton({icon:t[i],iconComponent:"atto_cloudpoodll",title:t[i]+"_desc",buttonName:t[i],callback:this._displayDialogue,callbackArgs:t[i]});A.insertmethod=e.insertmethod,A.subtitleaudiobydefault=e.subtitleaudiobydefault,A.subtitlevideobydefault=e.subtitlevideobydefault,A.transcoding="1"==e.cp_transcode,A.filetitledisplaylength=e.filetitle_displaylength,A.showhistory="1"==e.showhistory,m.parent=M.cfg.wwwroot,m.appid="atto_cloudpoodll",m.token=e.cp_token,m.region=e.cp_region,m.owner=e.cp_owner,m.expiredays=e.cp_expiredays,m.cansubtitle=e.cp_cansubtitle,m.language=e.cp_language,m.transcode=e.cp_transcode,m.audioskin=e.cp_audioskin,m.videoskin=e.cp_videoskin,m.fallback=e.fallback,m.keys=e.keys,m.names=e.names,m.instructions=e.instructions,m.defaults=e.defaults,m.variables=e.variables,m.ends=e.ends,m.sizes=this._fetchRecorderDimensions()}},_getContext:function(e){return c.merge({elementid:this.get("host").get("elementid"),component:p,helpStrings:this.get("help"),isvideo:A.currentrecorder===r,showhistory:A.showhistory,cansubtitle:m.cansubtitle,recorder:A.currentrecorder,mediataginsert:A.insertmethod===_,subtitleaudiobydefault:A.subtitleaudiobydefault,subtitlevideobydefault:A.subtitlevideobydefault,letssubtitleaudio:1==A.subtitleaudiobydefault,letssubtitlevideo:1==A.subtitlevideobydefault,useENUS:m.language===t.ENUS,useENGB:m.language===t.ENGB,useENAU:m.language===t.ENAU,useENIN:m.language===t.ENIN,useFRCA:m.language===t.FRCA,useFRFR:m.language===t.FRFR,useESUS:m.language===t.ESUS,useESES:m.language===t.ESES,useITIT:m.language===t.ITIT,usePTBR:m.language===t.PTBR,useDEDE:m.language===t.DEDE,useKOKR:m.language===t.KOKR,useHIIN:m.language===t.HIIN,useARAE:m.language===t.ARAE,useARSA:m.language===t.ARSA,useZHCN:m.language===t.ZHCN,useNLNL:m.language===t.NLNL,useENIE:m.language===t.ENIE,useENWL:m.language===t.ENWL,useENAB:m.language===t.ENAB,useFAIR:m.language===t.FAIR,useDECH:m.language===t.DECH,useHEIL:m.language===t.HEIL,useIDID:m.language===t.IDID,useJAJP:m.language===t.JAJP,useMSMY:m.language===t.MSMY,usePTPT:m.language===t.PTPT,useRURU:m.language===t.RURU,useTAIN:m.language===t.TAIN,useTEIN:m.language===t.TEIN,useTRTR:m.language===t.TRTR,CSS:v,CP:m,LANG:t},e)},_fetchRecorderDimensions:function(){var e={};switch(m.videoskin){case h:e.videowidth=441,e.videoheight=540;break;case b:e.videowidth=441,e.videoheight=500;break;default:e.videowidth=441,e.videoheight=450}return m.audioskin,e.audiowidth=450,e.audioheight=350,e},_displayWidgetsDialogue:function(e,t){var i,a,o,n,l,s;e.preventDefault(),i=800,(a=this.getDialogue({headerContent:M.util.get_string("dialogtitle",p),width:i+"px",focusAfterHide:t})).width!==i+"px"&&a.set("width",i+"px"),o=c.Node.create("<div></div>"),n=c.Handlebars.compile(d),l=c.Node.create(n({headertext:M.util.get_string("chooseinsert",p)})),o.append(l),s=this._getButtonsForNames(t),c.Array.each(s,function(e){o.append(e)},o),a.set("bodyContent",o),a.show(),this.markUpdated()},_getButtonsForNames:function(e){var o=[];return c.Array.each(m.names,function(e,t){var i=c.Handlebars.compile(l),a=c.Node.create(i({elementid:this.get("host").get("elementid"),name:e,templateindex:t}));(this._form=a).one("."+v.NAMEBUTTON+"_"+t).on("click",this._showTemplateForm,this,t),o.push(a)},this),o},_getSubmitButtons:function(e){var t=c.Handlebars.compile(a),i=c.Node.create(t({elementid:this.get("host").get("elementid"),inserttext:M.util.get_string("insert",p)}));return i.one("."+v.INPUTSUBMIT).on("click",this._doWidgetsInsert,this,e),i},_doWidgetsInsert:function(e,t){var o,i,a,n,l,s;e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),o="{POODLL:type=",i=m.keys[t],a=m.variables[t],n=m.defaults[t],l=m.ends[t],s=n,o+='"'+i+'"',c.Array.each(a,function(e,t){
var i=c.one("."+v.TEMPLATEVARIABLE+"_"+t),a=i.get("value");a&&a!=s[e]&&(o+=","+e+'="'+a+'"')},this),o+="}",l&&(o+='<br/>{POODLL:type="'+i+'_end"}'),this.editor.focus(),this.get("host").insertContentAtFocusPoint(o),this.markUpdated()},_showTemplateForm:function(e,t){var i,a,o,n,l,s,d,r,u;e.preventDefault(),i=800,(a=this.getDialogue({headerContent:M.util.get_string("dialogtitle",p),width:i+"px"})).width!==i+"px"&&a.set("width",i+"px"),o=this._getTemplateFields(t),n=m.instructions[t],n=decodeURIComponent(n),l=o&&0<o.length?M.util.get_string("fieldsheader",p):M.util.get_string("nofieldsheader",p),s=c.Handlebars.compile(y),d=c.Node.create(s({key:m.keys[t],headertext:l,instructions:n})),(r=c.Node.create("<div />")).append(d),c.Array.each(o,function(e){r.append(e)},r),u=this._getSubmitButtons(t),r.append(u),a.set("bodyContent",r),a.show(),this.markUpdated()},_getTemplateFields:function(e){var r=[],t=(m.keys[e],m.variables[e]),i=m.defaults[e],u=i;return c.Array.each(t,function(e,t){var i,a,o,n,l,s,d;e in u&&-1<u[e].indexOf("|")?(i=c.Handlebars.compile(S),a=c.Node.create(i({elementid:this.get("host").get("elementid"),variable:e,defaultvalue:u[e],variableindex:t})),o=c.Handlebars.compile(E),n=c.Node.create(o({variable:e,defaultvalue:u[e],variableindex:t})),l=u[e].split("|"),s=c.Handlebars.compile(N),c.Array.each(l,function(e,t){var i=c.Node.create(s({option:e}));n.appendChild(i)}),a.appendChild(n)):(d=c.Handlebars.compile(C),a=c.Node.create(d({elementid:this.get("host").get("elementid"),variable:e,defaultvalue:u[e],variableindex:t}))),r.push(a)},this),r},_displayDialogue:function(e,t){var i,a,o,n,l,s,d;if(e.preventDefault(),"widgets"!=(this._currentrecorder=t)){switch(A.currentrecorder=t){case r:switch(i=M.util.get_string("createvideo",p),m.videoskin){case h:a="500",o="660";break;case f:a="500",o="580";break;case b:a="500",o="620";break;default:o=!(a="500")}break;case u:default:i=M.util.get_string("createaudio",p),o=!(a="501")}m.cansubtitle?A.currentrecorder==r?A.subtitling=A.subtitlevideobydefault:A.subtitling=A.subtitleaudiobydefault:A.subtitling=0,(n={center:!0}).headerContent=i,n.focusAfterHide=t,n.width=a+"px",o&&(n.height=o+"px"),(l=this.getDialogue(n)).get("width")!=a+"px"&&(l.set("headerContent",i),l.set("width",a+"px"),l.set("height",o+"px")),l.set("bodyContent",this._getDialogueContent()).show(),A.elementid=this.get("host").get("elementid"),A.subtitlecheckbox=c.one("#"+A.elementid+"_"+v.SUBTITLE_CHECKBOX),A.mediainsertcheckbox=c.one("#"+A.elementid+"_"+v.MEDIAINSERT_CHECKBOX),A.languageselect=c.one("#"+A.elementid+"_"+v.LANG_SELECT),s=c.one("#"+A.elementid+"_"+v.ATTO_CLOUDPOODLL_FORM),I=d=this,null!=A.subtitlecheckbox&&(m.cansubtitle?A.subtitlecheckbox.on("click",function(e){e.currentTarget.get("checked")?(s.all("."+v.CP_SWAP).setAttribute("data-transcribe","1"),s.all("."+v.CP_SWAP).setAttribute("data-subtitle","1"),s.all("."+v.CP_SWAP).setAttribute("data-alreadyparsed","false"),A.subtitling=!0):(s.all("."+v.CP_SWAP).setAttribute("data-transcribe","0"),s.all("."+v.CP_SWAP).setAttribute("data-subtitle","0"),s.all("."+v.CP_SWAP).setAttribute("data-alreadyparsed","false"),A.subtitling=!1),s.all("."+v.CP_SWAP).empty(),d._loadRecorders()}):this._disableSubtitleCheckbox()),null!=A.mediainsertcheckbox&&A.mediainsertcheckbox.on("click",function(e){e.currentTarget.get("checked")?A.insertmethod=_:A.insertmethod=g}),null!=A.languageselect&&A.languageselect.on("change",function(e){var t=e.currentTarget;t&&(m.language=t.selectedOptionValue(),s.all("."+v.CP_SWAP).setAttribute("data-language",m.language),s.all("."+v.CP_SWAP).setAttribute("data-alreadyparsed","false"),s.all("."+v.CP_SWAP).empty(),d._loadRecorders())}),this._loadRecorders()}else this._displayWidgetsDialogue(e,t)},_disableSubtitleCheckbox:function(){A.subtitlecheckbox.setAttribute("disabled",!0);var e=c.one("#"+A.elementid+"_"+v.ATTO_CLOUDPOODLL_FORM);e.all("."+v.CP_SWAP).setAttribute("data-transcribe","0"),e.all("."+v.CP_SWAP).setAttribute("data-subtitle","0")},loadHistory:function(){require(["core/templates","core/ajax","core/notification"],function(i,e,a){e.call([{methodname:"atto_cloudpoodll_history_get_items",args:{recordertype:A.currentrecorder},done:function(e){Array.isArray(e.responses)&&(e.responses.forEach(function(e){e.displaydateofentry=function n(e){var t=new Date(1e3*e),i=t.getUTCMonth()+1,a=t.getUTCDate(),o=t.getUTCFullYear();return i+"/"+a+"/"+o}(e.dateofentry),e.displayfiletitle=e.filetitle.substring(0,A.filetitledisplaylength)+"..."}),e.responses.formatted=JSON.stringify(e.responses));var t={data:e.responses};i.render("atto_cloudpoodll/history",t).then(function(e,t){i.replaceNodeContents('div[data-field="history"]',e,t)}).fail(function(e){a.exception(e)})}}])})},loadHistoryPreview:function(t){require(["core/templates","core/ajax","core/notification"],function(i,e,a){e.call([{methodname:"atto_cloudpoodll_history_get_item",args:{id:t.dataset.historyId},done:function(e){var t={data:e.responses,isVideo:A.currentrecorder===r};i.render("atto_cloudpoodll/historypreview",t).then(function(e,t){i.replaceNodeContents('div[data-field="history"]',e,t)}).fail(function(e){a.exception(e)})}}])})},_loadRecorders:function(){var n=this;n.uploaded=!1,n.ap_count=0,require(["atto_cloudpoodll/cloudpoodllloader"],function(o){o.init(v.CP_SWAP,function(a){switch(a.type){case"recording":"started"===a.action&&null!=A.subtitlecheckbox&&A.subtitlecheckbox.set("disabled",!0);break;case"awaitingprocessing":n.uploaded||(setTimeout(function(){var e=o.fetch_guessed_extension(A.currentrecorder),t=a.sourcefilename.split(".").slice(0,-1).join(".")+"."+e,i=a.s3root+t;n._doInsert(a.mediaurl,a.mediafilename,i,a.sourcemimetype)},4e3),n.uploaded=!0);break;case"filesubmitted":break;case"error":alert("PROBLEM:"+a.message)}})})},_getDialogueContent:function(e){var t="";return t=""==m.token?M.util.get_string("notoken",p):c.Handlebars.compile(i)(this._getContext()),c.Node.create(t)},insertHistoryItem:function(t){I.getDialogue({focusAfterHide:null}).hide(),require([
"core/ajax"],function(e){e.call([{methodname:"atto_cloudpoodll_history_get_item",args:{id:t.dataset.historyId},done:function(e){var t=e.responses[0],i=I._createMediaLink(t.mediaurl,t.mediafilename,t.sourceurl,t.sourcemimetype);switch(A.insertmethod){case _:i.template=I._createMediaTemplate(i.context,t.sourcemimetype,i.template)}I._insertIntoEditor(i.template,i.context)}}])})},_createMediaLink:function(e,t,i,a){var o={};return o.url=e,o.name=t,o.issubtitling=A.subtitling&&"0"!==A.subtitling,o.includesourcetrack=A.transcoding&&e!==i&&"wav"!==i.slice(-3)&&!1!==i,o.CP=m,o.subtitleurl=e+".vtt",o.sourceurl=i,o.sourcemimetype=a,{context:o,template:n.LINK}},_insertIntoEditor:function(e,t){var i=c.Handlebars.compile(e)(t);this.editor.focus(),this.get("host").insertContentAtFocusPoint(i),this.markUpdated()},_createMediaTemplate:function(e,t,i){return A.currentrecorder===r?(e.width=!1,e.height=!1,e.poster=!1,A.transcoding?e.urlmimetype="video/mp4":e.urlmimetype=t,n.VIDEO):(e.width=!1,e.height=!1,e.poster=!1,A.transcoding?e.urlmimetype="audio/mp3":e.urlmimetype=t,n.AUDIO)},_doInsert:function(t,i,a,o){var e,n,l;switch(this.getDialogue({focusAfterHide:null}).hide(),n=(e=this._createMediaLink(t,i,a,o)).context,l=e.template,A.insertmethod){case _:l=this._createMediaTemplate(n,o,l)}!function s(){require(["core/ajax"],function(e){e.call([{methodname:"atto_cloudpoodll_history_create",args:{recordertype:A.currentrecorder,mediafilename:i,sourceurl:a,mediaurl:t,sourcemimetype:o,subtitling:A.subtitling?1:0,subtitleurl:A.subtitling?t+".vtt":""}}])})}(),this._insertIntoEditor(l,n)}},{ATTRS:{disabled:{value:!1}}})},"@VERSION@");