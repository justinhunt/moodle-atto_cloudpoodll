YUI.add("moodle-atto_cloudpoodll-button",function(e,t){var n="atto_cloudpoodll",r={VIDEO:"video",AUDIO:"audio"},i={LINK:"link",TAGS:"tags"},s={ENUS:"en-US",ESUS:"es-US"},o={},u={VIDEO:"atto_cloudpoodll_video",AUDIO:"atto_cloudpoodll_audio",UPLOAD:"atto_cloudpoodll_upload",SUBTITLE:"atto_cloudpoodll_subtitle",OPTIONS:"atto_cloudpoodll_options",LANG_SELECT:"atto_cloudpoodll_languageselect",SUBTITLE_CHECKBOX:"atto_cloudpoodll_subtitle_checkbox",MEDIAINSERT_CHECKBOX:"atto_cloudpoodll_mediainsert_checkbox",ATTO_CLOUDPOODLL_FORM:"atto_cloudpoodll_form",CP_VIDEO:"atto_cloudpoodll_video_cont",CP_AUDIO:"atto_cloudpoodll_audio_cont",CP_UPLOAD:"atto_cloudpoodll_upload_cont",CP_SWAP:"atto_cloudpoodll_swapmeout"},a={subtitling:!1,started:!1,currentrecorder:!1,insertmethod:!1,subitleaudiobydefault:0,subitlevideobydefault:0,elementid:!1,subtitlecheckbox:!1},f={ROOT:'<form class="mform atto_form atto_media atto_cloudpoodll_form" id="{{elementid}}_atto_cloudpoodll_form"><ul class="root nav nav-tabs" role="tablist">{{#if isvideo}}<li data-medium-type="{{CSS.VIDEO}}" class="nav-item"><a class="nav-link active" href="#{{elementid}}_{{CSS.VIDEO}}" role="tab" data-toggle="tab">{{get_string "video" component}}</a></li>{{else}}<li data-medium-type="{{CSS.AUDIO}}" class="nav-item"><a class="nav-link active" href="#{{elementid}}_{{CSS.AUDIO}}" role="tab" data-toggle="tab">{{get_string "audio" component}}</a></li>{{/if}}<li data-medium-type="{{CSS.UPLOAD}}" class="nav-item"><a class="nav-link" href="#{{elementid}}_{{CSS.UPLOAD}}" role="tab" data-toggle="tab">{{get_string "upload" component}}</a></li><li data-medium-type="{{CSS.OPTIONS}}" class="nav-item"><a class="nav-link" href="#{{elementid}}_{{CSS.OPTIONS}}" role="tab" data-toggle="tab">{{get_string "options" component}}</a></li></ul><div class="root tab-content">{{#if isvideo}}<div data-medium-type="{{CSS.VIDEO}}" class="tab-pane active" id="{{elementid}}_{{CSS.VIDEO}}"><div id="{{elementid}}_{{CSS.CP_VIDEO}}" class="{{CSS.CP_SWAP}}" data-id="{{elementid}}_{{CSS.CP_VIDEO}}" data-parent="{{CP.parent}}"data-media="video" data-type="{{CP.videoskin}}" data-width="450" data-height="380"data-transcode="{{CP.transcode}}" data-transcribe="{{subtitlevideobydefault}}" data-transcribelanguage="{{CP.language}}"data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-token="{{CP.token}}" data-fallback="{{CP.fallback}}"></div></div>{{else}}<div data-medium-type="{{CSS.AUDIO}}" class="tab-pane active" id="{{elementid}}_{{CSS.AUDIO}}"><div id="{{elementid}}_{{CSS.CP_AUDIO}}" class="{{CSS.CP_SWAP}}" data-id="{{elementid}}_{{CSS.CP_AUDIO}}" data-parent="{{CP.parent}}"data-media="audio" data-type="{{CP.audioskin}}" data-width="450" data-height="350"data-transcode="{{CP.transcode}}" data-transcribe="{{subtitleaudiobydefault}}" data-transcribelanguage="{{CP.language}}"data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-token="{{CP.token}}" data-fallback="{{CP.fallback}}"></div></div>{{/if}}<div data-medium-type="{{CSS.UPLOAD}}" class="tab-pane" id="{{elementid}}_{{CSS.UPLOAD}}"><br>{{get_string "uploadinstructions" component}}<div id="{{elementid}}_{{CSS.CP_UPLOAD}}" class="{{CSS.CP_SWAP}}" data-id="{{elementid}}_{{CSS.CP_UPLOAD}}" data-parent="{{CP.parent}}"data-media="{{recorder}}" data-type="upload" data-width="450" data-height="350"data-transcode="{{CP.transcode}}" {{#if isvideo}}data-transcribe="{{subtitlevideobydefault}}" {{else}}data-transcribe="{{subtitleaudiobydefault}}" {{/if}}data-transcribelanguage="{{CP.language}}"data-expiredays="{{CP.expiredays}}" data-region="{{CP.region}}" data-token="{{CP.token}}"></div></div><div data-medium-type="{{CSS.OPTIONS}}" class="tab-pane" id="{{elementid}}_{{CSS.OPTIONS}}"><br><label><input type="checkbox" id="{{elementid}}_{{CSS.MEDIAINSERT_CHECKBOX}}" class="{{CSS.MEDIAINSERT_CHECKBOX}}"{{#if mediataginsert}} checked="true" {{/if}}/>&nbsp;{{get_string "mediainsertcheckbox" component}}</label>{{#if cansubtitle}}<br><label><input type="checkbox" id="{{elementid}}_{{CSS.SUBTITLE_CHECKBOX}}" class="{{CSS.SUBTITLE_CHECKBOX}}"{{#if isvideo}}{{#if letssubtitlevideo}} checked="true" {{/if}}{{else}}{{#if letssubtitleaudio}} checked="true" {{/if}}{{/if}}/>&nbsp;{{get_string "subtitlecheckbox" component}}</label><br><label>{{get_string "speakerlanguage" component}}&nbsp;<select id="{{elementid}}_{{CSS.LANG_SELECT}}" class="{{CSS.LANG_SELECT}}"><option value="{{LANG.ENUS}}" {{#if useenglish}}selected="selected"{{/if}}>{{get_string "en-us" component}}</option><option value="{{LANG.ESUS}}" {{#if usespanish}}selected="selected"{{/if}}>{{get_string "es-us" component}}</option></select></label><br>{{get_string "subtitleinstructions" component}}{{/if}}</div></div></form>',HTML_MEDIA:{VIDEO:'&nbsp;<video controls="true" crossorigin="anonymous"><source src="{{url}}">{{#if issubtitling}}<track src="{{subtitleurl}}" kind="captions" srclang="{{CP.language}}" label="{{CP.language}}" default="true">{{/if}}</video>&nbsp;',AUDIO:'&nbsp;<audio controls="true" crossorigin="anonymous"><source src="{{url}}">{{#if issubtitling}}<track src="{{subtitleurl}}" kind="captions" srclang="{{CP.language}}" label="{{CP.language}}" default="true">{{/if}}</audio>&nbsp;',LINK:'{{#if issubtitling}}&nbsp;<a href="{{url}}?data-subtitles={{subtitleurl}}&data-language={{CP.language}}"{{else}}&nbsp;<a href="{{url}}"{{/if}}>{{name}}</a>&nbsp;'}};e.namespace("M.atto_cloudpoodll").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(e){var t=new Array("audio","video");for(var n=0;n<t.length;n++)e.hasOwnProperty(t[n])&&this.addButton({icon:t[n],iconComponent:"atto_cloudpoodll",title:t[n]+"_desc",buttonName:t[n],callback:this._displayDialogue,callbackArgs:t[n]});a.insertmethod=e.insertmethod,a.subtitleaudiobydefault=e.subtitleaudiobydefault,a.subtitlevideobydefault=e.subtitlevideobydefault,o.parent=M.cfg.wwwroot,o.token=e.cp_token,o.region=e.cp_region,o.expiredays=e.cp_expiredays,o.cansubtitle=e.cp_cansubtitle,o.language=e.cp_language
,o.transcode=e.cp_transcode,o.audioskin=e.cp_audioskin,o.videoskin=e.cp_videoskin,o.fallback=e.fallback},_getContext:function(t){return e.merge({elementid:this.get("host").get("elementid"),component:n,helpStrings:this.get("help"),isvideo:a.currentrecorder==r.VIDEO,cansubtitle:o.cansubtitle,recorder:a.currentrecorder,mediataginsert:a.insertmethod==i.TAGS,subtitleaudiobydefault:a.subtitleaudiobydefault,subtitlevideobydefault:a.subtitlevideobydefault,letssubtitleaudio:a.subtitleaudiobydefault==1,letssubtitlevideo:a.subtitlevideobydefault==1,useenglish:o.language==s.ENUS,usespanish:o.language==s.ESUS,CSS:u,CP:o,LANG:s},t)},_displayDialogue:function(t,s){if(this.get("host").getSelection()===!1)return;a.currentrecorder=s;switch(s){case r.VIDEO:var f=M.util.get_string("createvideo",n),l="500px";break;case r.AUDIO:default:var f=M.util.get_string("createaudio",n),l="500px"}var c={};c.headerContent=f,c.focusAfterHide=s,c.width=l;var h=this.getDialogue(c);h.set("bodyContent",this._getDialogueContent()).show(),a.elementid=this.get("host").get("elementid"),a.subtitlecheckbox=e.one("#"+a.elementid+"_"+u.SUBTITLE_CHECKBOX),a.mediainsertcheckbox=e.one("#"+a.elementid+"_"+u.MEDIAINSERT_CHECKBOX),a.languageselect=e.one("#"+a.elementid+"_"+u.LANG_SELECT);var p=e.one("#"+a.elementid+"_"+u.ATTO_CLOUDPOODLL_FORM),d=this;a.subtitlecheckbox!=null&&a.subtitlecheckbox.on("click",function(e){var t=e.currentTarget;t.get("checked")?(p.all("."+u.CP_SWAP).setAttribute("data-transcribe","1"),p.all("."+u.CP_SWAP).setAttribute("data-subtitle","1"),p.all("."+u.CP_SWAP).setAttribute("data-alreadyparsed","false"),a.subtitling=!0):(p.all("."+u.CP_SWAP).setAttribute("data-transcribe","0"),p.all("."+u.CP_SWAP).setAttribute("data-subtitle","0"),p.all("."+u.CP_SWAP).setAttribute("data-alreadyparsed","false"),a.subtitling=!1),p.all("."+u.CP_SWAP).empty(),d._loadRecorders()}),a.mediainsertcheckbox!=null&&a.mediainsertcheckbox.on("click",function(e){var t=e.currentTarget;t.get("checked")?a.insertmethod=i.TAGS:a.insertmethod=i.LINK}),a.languageselect!=null&&a.languageselect.on("change",function(e){debugger;var t=e.currentTarget;t&&(o.language=t.selectedOptionValue(),p.all("."+u.CP_SWAP).setAttribute("data-transcribelanguage",o.language),p.all("."+u.CP_SWAP).setAttribute("data-alreadyparsed","false"),p.all("."+u.CP_SWAP).empty(),d._loadRecorders())}),this._loadRecorders()},_loadRecorders:function(){var e=this;e.uploaded=!1,require(["atto_cloudpoodll/cloudpoodllloader"],function(t){var n=function(t){switch(t.type){case"recording":t.action==="started"&&a.subtitlecheckbox!=null&&a.subtitlecheckbox.set("disabled",!0);break;case"awaitingprocessing":e.uploaded||(e._doInsert(t.mediaurl,t.mediafilename),e.uploaded=!0)}};t.init(u.CP_SWAP,n)})},_getDialogueContent:function(t){var n=e.Node.create(e.Handlebars.compile(f.ROOT)(this._getContext()));return n},_doInsert:function(t,n){this.getDialogue({focusAfterHide:null}).hide();var s={};s.url=t,s.name=n,s.issubtitling=a.subtitling,s.CP=o,s.subtitleurl=t+".vtt";var u=f.HTML_MEDIA.LINK;switch(a.insertmethod){case i.TAGS:a.currentrecorder==r.VIDEO?(s.width=!1,s.height=!1,s.poster=!1,u=f.HTML_MEDIA.VIDEO):(s.width=!1,s.height=!1,s.poster=!1,u=f.HTML_MEDIA.AUDIO);break;case i.LINK:default:}var l=e.Handlebars.compile(u)(s);this.editor.focus(),this.get("host").insertContentAtFocusPoint(l),this.markUpdated()}},{ATTRS:{disabled:{value:!1}}})},"@VERSION@");
